wp_optimize_send_command_admin_ajax=function(t,i,e,o){o="undefined"==typeof o||o;var n={action:"wp_optimize_ajax",subaction:t,nonce:wp_optimize_ajax_nonce,data:i};jQuery.post(ajaxurl,n,function(t){if(o){try{var i=JSON.parse(t)}catch(n){return console.log(n),console.log(t),void alert(wpoptimize.error_unexpected_response)}"undefined"!=typeof e&&e(i)}else"undefined"!=typeof e&&e(t)})},jQuery(document).ready(function(t){WP_Optimize=WP_Optimize(wp_optimize_send_command_admin_ajax)});var WP_Optimize=function(t){function i(){if(k("#enable-schedule").length){var t=k("#enable-schedule").is(":checked");t?k("#wp-optimize-auto-options").css("opacity","1"):k("#wp-optimize-auto-options").css("opacity","0.5")}}function e(t,i,e){i="undefined"==typeof i?"#wp-optimize-wrap":i,e="undefined"==typeof e?15:e,k(t).hide().prependTo(i).slideDown("slow").delay(1e3*e).slideUp("slow",function(){k(this).remove()})}function o(i,o){var n={type:i,enable:o?1:0};k("#"+i+"_spinner").show(),t("enable_or_disable_feature",n,function(t){if(k("#"+i+"_spinner").hide(),t&&t.hasOwnProperty("output"))for(var o=0,n=t.output.length;o<n;o++){var a='<div class="updated">'+t.output[o]+"</div>";e(a,"#actions-results-area")}})}function n(t){var i="",t="undefined"==typeof t?"string":t;return"object"==t?i=k("#wp-optimize-nav-tab-contents-settings form input[name!='action'], #wp-optimize-nav-tab-contents-settings form textarea, #wp-optimize-nav-tab-contents-settings form select, #wp-optimize-nav-tab-contents-optimize input[type='checkbox'], .wp-optimize-nav-tab-contents input[name^='enable-auto-backup-']").serializeJSON({useIntKeysAsArrayIndex:!0}):(i=k("#wp-optimize-nav-tab-contents-settings form input[name!='action'], #wp-optimize-nav-tab-contents-settings form textarea, #wp-optimize-nav-tab-contents-settings form select, #wp-optimize-nav-tab-contents-optimize input[type='checkbox'], .wp-optimize-nav-tab-contents input[name^='enable-auto-backup-']").serialize(),k.each(k('#wp-optimize-nav-tab-contents-settings form input[type=checkbox], .wp-optimize-nav-tab-contents input[name^="enable-auto-backup-"]').filter(function(t){return 0==k(this).prop("checked")}),function(t,e){var o="0";i+="&"+k(e).attr("name")+"="+o})),i}function a(){t("optimizations_done",{},function(){})}function s(){if(!j.get_lock())return void(x>0&&console.log("WP-Optimize: process_queue(): queue is currently locked - exiting"));x>0&&console.log("WP-Optimize: process_queue(): got queue lock");var i=j.peek();return"object"==typeof i?(data=i,i=i.optimization_id):data={},"undefined"==typeof i?(x>0&&console.log("WP-Optimize: process_queue(): queue is apparently empty - exiting"),j.unlock(),void a()):(x>0&&console.log("WP-Optimize: process_queue(): processing item: "+i),j.dequeue(),k(document).trigger(["do_optimization_",i,"_start"].join("")),void t("do_optimization",{optimization_id:i,data:data},function(t){if(k("#optimization_spinner_"+i).hide(),k("#optimization_checkbox_"+i).show(),k(".optimization_button_"+i).prop("disabled",!1),k(document).trigger(["do_optimization_",i,"_done"].join(""),t),t){for(var e="",o=0,n=t.errors.length;o<n;o++)e+='<span class="error">'+t.errors[o]+"</span><br>";for(var o=0,n=t.messages.length;o<n;o++)e+=t.errors[o]+"<br>";for(var o=0,n=t.result.output.length;o<n;o++)e+=t.result.output[o]+"<br>";if(k("#optimization_info_"+i).html(e),t.hasOwnProperty("status_box_contents")&&k("#wp_optimize_status_box").css("opacity","1").find(".inside").html(t.status_box_contents),t.hasOwnProperty("table_list")&&k("#wpoptimize_table_list tbody").html(k(t.table_list).find("tbody").html()),t.hasOwnProperty("total_size")&&k("#optimize_current_db_size").html(t.total_size),"optimizetables"==i&&data.optimization_table&&(j.is_empty()?(k("#optimization_spinner_"+i).hide(),k("#optimization_checkbox_"+i).show(),k(".optimization_button_"+i).prop("disabled",!1),k("#optimization_info_"+i).html(wpoptimize.optimization_complete)):(k("#optimization_checkbox_"+i).hide(),k("#optimization_spinner_"+i).show(),k(".optimization_button_"+i).prop("disabled",!0))),t.result.meta&&t.result.meta.hasOwnProperty("awaiting_mod")){var a=t.result.meta.awaiting_mod;a>0?k("#adminmenu .awaiting-mod .pending-count").remove(a):k("#adminmenu .awaiting-mod").remove()}}setTimeout(function(){j.unlock(),s()},10)}))}function p(t){var i=k("#wp-optimize-nav-tab-contents-optimize .wp-optimize-settings-"+t);if(i||console.log("do_optimization: row corresponding to this optimization ("+t+") not found"),1!=k(".optimization_button_"+t).prop("disabled")){if(k("#optimization_checkbox_"+t).hide(),k("#optimization_spinner_"+t).show(),k(".optimization_button_"+t).prop("disabled",!0),k("#optimization_info_"+t).html("..."),"optimizetables"==t){var e=k("#wpoptimize_table_list #the-list tr");k(e).each(function(i){var e=k(this).find("td");if(table_type=e.eq(5).text(),table=e.eq(1).text(),optimizable=e.eq(5).data("optimizable"),""!=table&&("1"==optimizable||R)){var o={optimization_id:t,optimization_table:e.eq(1).text(),optimization_table_type:table_type,optimization_force:R};j.enqueue(o)}})}else j.enqueue(t);s()}}function r(i){k("#wpo_settings_sites_list").length?t("save_site_settings",{"wpo-sites":_()},function(){i&&i()}):i&&i()}function _(){var t=[];return k('#wpo_settings_sites_list input[type="checkbox"]').each(function(){var i=k(this);i.is(":checked")&&t.push(i.attr("value"))}),t}function l(){var t=!1;k("#enable-auto-backup").is(":checked")&&(t=!0),u(),1==t?c(f):f()}function c(t){"function"==typeof updraft_backupnow_inpage_go?updraft_backupnow_inpage_go(function(){k("#updraft-backupnow-inpage-modal").dialog("close"),t&&t()},"","autobackup",0,1,0,wpoptimize.automatic_backup_before_optimizations):t&&t()}function u(){var i=n("object");i.auto_backup=k("#enable-auto-backup").is(":checked"),t("save_auto_backup_option",i)}function d(t,i,e,o){t.on("click",function(){return i.hasClass("wpo_always_visible")||i.toggleClass("wpo_hidden"),!1}),e.on("change",function(){e.is(":checked")?o.prop("checked",!0):o.prop("checked",!1),m(e,o)}),o.on("change",function(){m(e,o)}),m(e,o)}function m(t,i){var e=0,o=0;if(i.each(function(){k(this).is(":checked")&&o++,e++}),t.next().is("label")&&t.next().data("label")){var n=t.next(),a=n.data("label");e==o?n.text(a):n.text(a.replace("all",[o," of ",e].join("")))}e==o?t.prop("checked",!0):t.prop("checked",!1)}function f(){$optimizations=k("#optimizations_list .optimization_checkbox:checked"),$optimizations.sort(function(t,i){return t=k(t).closest(".wp-optimize-settings").data("optimization_run_sort_order"),i=k(i).closest(".wp-optimize-settings").data("optimization_run_sort_order"),t>i?1:t<i?-1:0});var i={};$optimizations.each(function(t){var e=k(this).closest(".wp-optimize-settings").data("optimization_id");return e?(i[e]={active:1},void p(e)):void console.log("Optimization ID corresponding to pressed button not found")}),t("save_manual_run_optimization_options",i)}function g(t){k(".run-single-table-optimization").each(function(){var i=k(this);i.data("disabled")&&(t?i.prop("disabled",!1):i.prop("disabled",!0))})}function w(t){var i,e,o;if(t)for(i in t)t.hasOwnProperty(i)&&(e=["#wp-optimize-settings-",t[i].dom_id].join(""),o=t[i].info?t[i].info.join("<br>"):"",k(e+" .wp-optimize-settings-optimization-info").html(o))}function b(){var i=["",_().join("_")].join("");Y.hasOwnProperty(i)?w(Y[i]):t("get_optimizations_info",{"wpo-sites":_()},function(t){t&&(Y[i]=t,w(t))})}function h(i){var e=k("#wpo_import_spinner"),o=k("#wpo_import_success_message"),n=k("#wpo_import_error_message");e.show(),t("import_settings",{settings:i},function(t){e.hide(),t&&t.errors&&t.errors.length?(n.text(t.errors.join("<br>")),n.slideDown()):t&&t.messages&&t.messages.length&&(o.text(t.messages.join("<br>")),o.slideDown(),setTimeout(function(){window.location.reload()},500)),k("#wpo_import_settings_btn").prop("disabled",!1)})}function z(t,i){var e=document.body.appendChild(document.createElement("a")),o=new Date,n=o.getFullYear(),a=o.getMonth()<10?["0",o.getMonth()].join(""):o.getMonth(),s=o.getDay()<10?["0",o.getDay()].join(""):o.getDay();i=i?i:["wpo-settings-",n,"-",a,"-",s,".json"].join(""),e.setAttribute("download",i),e.setAttribute("style","display:none;"),e.setAttribute("href","data:text/json;charset=UTF-8,"+encodeURIComponent(JSON.stringify(t))),e.click()}function v(){var t=!0;return k(".wpo_logger_addition_option, .wpo_logger_type").each(function(){y(k(this),!0)?k(this).removeClass("wpo_error_field"):(t=!1,k(this).addClass("wpo_error_field"))}),t?k("#wp-optimize-logger-settings .save_settings_reminder").slideUp():k("#wp-optimize-settings-save-results").show().addClass("wpo_alert_notice").text(wpoptimize.fill_all_settings_fields).delay(5e3).fadeOut(3e3,function(){k(this).removeClass("wpo_alert_notice")}),t}function y(t,i){var e=t.val(),o=t.data("validate");if(!o&&i)return""!=k.trim(e);if(o&&!i&&""==k.trim(e))return!0;var n=!0;switch(o){case"email":for(var a=/\S+@\S+\.\S+/,s=e.split(","),p="",r=0;r<s.length;r++)p=k.trim(s[r]),""!=p&&a.test(p)||(n=!1);break;case"url":var a=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i;n=a.test(e)}return n}var k=jQuery,x=0,j=new Updraft_Queue;i(),k("#enable-schedule").change(function(){i()});var O=k("#wpoptimize_table_list_filter"),P=k("#wpoptimize_table_list"),D=k("#wpoptimize_table_list tbody:last"),q=k("#wpoptimize_table_list_tables_not_found");k(function(){P.tablesorter({theme:"default",widgets:["zebra","rows","filter"],cssInfoBlock:"tablesorter-no-sort",headers:{7:{sorter:!1}},widgetOptions:{filter_external:O,filter_defaultFilter:{2:"~{query}"}}}),P.on("filterEnd",function(){var t=k.trim(O.val());""==t?D.show():D.hide(),0==k("#the-list tr:visible",P).length?q.show():q.hide()})}),k("#wp-optimize-disable-enable-trackbacks-enable").click(function(){o("trackbacks",!0)}),k("#wp-optimize-disable-enable-trackbacks-disable").click(function(){o("trackbacks",!1)}),k("#wp-optimize-disable-enable-comments-enable").click(function(){o("comments",!0)}),k("#wp-optimize-disable-enable-comments-disable").click(function(){o("comments",!1)}),k("#wp-optimize-nav-tab-wrapper .nav-tab").click(function(t){var i=k(this).attr("id");if(i&&"wp-optimize-nav-tab-"==i.substring(0,20)){var i=i.substring(20);t.preventDefault(),k("#wp-optimize-nav-tab-wrapper .nav-tab:not(#wp-optimize-nav-tab-"+i+")").removeClass("nav-tab-active"),k(this).addClass("nav-tab-active"),k("#wp-optimize-wrap .wp-optimize-nav-tab-contents:not(#wp-optimize-nav-tab-contents-"+i+")").hide(),k("#wp-optimize-nav-tab-contents-"+i).show(),"tables"==i&&k("#wpoptimize_table_list").trigger("applyWidgets")}}),k("#wp-optimize-nav-tab-contents-optimize").on("click","button.wp-optimize-settings-optimization-run-button",function(){var t=k(this).closest(".wp-optimize-settings").data("optimization_id");return t?void(1!=k(".optimization_button_"+t).prop("disabled")&&(k(".optimization_button_"+t).prop("disabled",!0),r(function(){k(".optimization_button_"+t).prop("disabled",!1),p(t)}))):void console.log("Optimization ID corresponding to pressed button not found")}),k("#wp-optimize-nav-tab-contents-optimize").on("click","#wp-optimize",function(t){var i=k(this);t.preventDefault(),i.prop("disabled",!0),r(function(){i.prop("disabled",!1),l()})});var C=k("#wpo_settings_sites_list"),S=C.find("ul").first(),T=k('input[type="checkbox"]',S),W=C.find("#wpo_all_sites"),A=k("#wpo_sitelist_show_moreoptions"),I=k("#wpo_sitelist_moreoptions"),U=k("#wpo_settings_sites_list_cron"),Q=U.find("ul").first(),$=k('input[type="checkbox"]',Q),F=U.find("#wpo_all_sites_cron"),J=k("#wpo_sitelist_show_moreoptions_cron"),M=k("#wpo_sitelist_moreoptions_cron");d(A,I,W,T);var N=0;k([W,T]).each(function(){k(this).on("change",function(){N++,setTimeout(function(){N--,0==N&&b()},1e3)})}),d(J,M,F,$),k("#wp_optimize_table_list_refresh").click(function(){k("#wpoptimize_table_list tbody").css("opacity","0.5"),t("get_table_list",!1,function(t){if(t.hasOwnProperty("table_list")){var i=!0,e=function(t){k("#wpoptimize_table_list tbody").css("opacity","1")};k("#wpoptimize_table_list").trigger("updateAll",[i,e])}t.hasOwnProperty("total_size")&&k("#optimize_current_db_size").html(t.total_size),g(K.is(":checked"))})}),k("#settings_form").on("click","#wp-optimize-settings-save",function(i){if(!v())return!1;i.preventDefault(),k("#save_spinner").show();var o=n();t("save_settings",o,function(t){if(k("#save_spinner").hide(),k("#save_done").show().delay(5e3).fadeOut(),t&&t.hasOwnProperty("save_results")&&t.save_results&&t.save_results.hasOwnProperty("errors")){for(var i=0,o=t.save_results.errors.length;i<o;i++){var n='<div class="error">'+t.errors[i]+"</div>";e(n,"#wp-optimize-settings-save-results")}console.log(t.save_results.messages)}t&&t.hasOwnProperty("status_box_contents")&&k("#wp_optimize_status_box .inside").html(t.status_box_contents),t&&t.hasOwnProperty("optimizations_table")&&k("#optimizations_list").replaceWith(t.optimizations_table),t.save_results.refresh&&location.reload()})}),k("#wp_optimize_status_box").on("click","#wp_optimize_status_box_refresh",function(i){i.preventDefault(),k("#wp_optimize_status_box").css("opacity","0.5"),t("get_status_box_contents",null,function(t){k("#wp_optimize_status_box").css("opacity","1").find(".inside").html(t)})});var E=k("#innodb_force_optimize"),R=E.is(":checked"),B=E.closest("tr"),K=k("#innodb_force_optimize_single");E.on("change",function(){k('button, input[type="checkbox"]',B).each(function(){R=E.is(":checked");var t=k(this);t.data("disabled")&&(R?t.prop("disabled",!1):t.prop("disabled",!0))})}),k("#wpoptimize_table_list").on("click",".run-single-table-optimization",function(){var i=k(this),e=i.next(),o=e.next(),n=i.data("table"),a=i.data("type"),s={optimization_id:"optimizetables",optimization_table:n,optimization_table_type:a};K.is(":checked")&&(s.optimization_force=!0),e.removeClass("visibility-hidden"),t("do_optimization",{optimization_id:"optimizetables",data:s},function(){i.prop("disabled",!1),e.addClass("visibility-hidden"),o.show().removeClass("visibility-hidden").delay(3e3).fadeOut("slow")})}),K.change(function(){g(K.is(":checked"))}),g(K.is(":checked"));var Y={};setTimeout(function(){t("check_overdue_crons",null,function(t){t&&t.hasOwnProperty("m")&&k("#wpo_settings_warnings").append(t.m)})},11e3),k("#wpo_import_settings_btn").on("click",function(t){var i=k("#wpo_import_settings_file"),e=i.val(),o=i[0].files[0],n=new FileReader;return k("#wpo_import_settings_btn").prop("disabled",!0),/\.json$/.test(e)?(n.onload=function(){h(this.result)},n.readAsText(o),!1):(t.preventDefault(),k("#wpo_import_settings_btn").prop("disabled",!1),k("#wpo_import_error_message").text(wpoptimize.please_select_settings_file).slideDown(),!1)}),k("#wpo_import_settings_file").on("change",function(){k("#wpo_import_error_message").slideUp()}),k("#wpo_export_settings_btn").on("click",function(t){return z(n("object")),!1});var G=function(i,e,o){t("get_optimization_info",{optimization_id:e,data:o},function(t){var o=t&&t.result&&t.result.meta?t.result.meta:{},n=t&&t.result&&t.result.output?t.result.output.join("<br>"):"...";k(document).trigger(["optimization_get_info_",e].join(""),n),i.html(n),o.finished?k(document).trigger(["optimization_get_info_",e,"_done"].join(""),t):setTimeout(function(){G(i,e,o)},1)})};return k(document).ready(function(){k(".wp-optimize-optimization-info-ajax").each(function(){var t=k(this),i=t.parent(),e=t.data("id");k(document).trigger(["optimization_get_info_",e,"_start"].join("")),G(i,e,{support_ajax_get_info:!0})})}),setTimeout(function(){t("check_overdue_crons",null,function(t){t&&t.hasOwnProperty("m")&&k("#wpo_settings_warnings").append(t.m)})},11e3),{send_command:t,optimization_get_info:G,take_a_backup_with_updraftplus:c,save_auto_backup_options:u}};jQuery(document).ready(function(t){function i(i){var e=["#",i.data("additional")].join("");i.is(":checked")?t(e).show():t(e).hide()}function e(){var i=t("#wp-optimize-logger-settings .save_settings_reminder");i.is(":visible")||i.slideDown("normal")}function o(){t(".wpo_logger_type").each(function(){n(t(this))})}function n(i){var e,o,n=a();for(e in n)o=n[e],wpoptimize.loggers_classes_info[o].allow_multiple?t('option[value="'+o+'"]',i).show():t('option[value="'+o+'"]',i).hide()}function a(){var i=[];return t(".wpo_logging_row, .wpo_logger_type").each(function(){var e=t(this).is("select")?t(this).val():t(this).data("id");e&&i.push(e)}),i}function s(){var t,i=['<option value="">Select destination</option>'];for(t in wpoptimize.loggers_classes_info)wpoptimize.loggers_classes_info.hasOwnProperty(t)&&i.push(['<option value="',t,'">',wpoptimize.loggers_classes_info[t].description,"</option>"].join(""));return['<div class="wpo_add_logger_form">','<select class="wpo_logger_type" name="wpo-logger-type[]">',i.join(""),"<select>",'<a href="#" class="wpo_delete_logger dashicons dashicons-no-alt"></a>','<div class="wpo_additional_logger_options"></div>',"</div>"].join("")}function p(i){if(!wpoptimize.loggers_classes_info[i].options)return"";var e,o=wpoptimize.loggers_classes_info[i].options,n=[],a="",s="";for(e in o)o.hasOwnProperty(e)&&(t.isArray(o[e])?(a=t.trim(o[e][0]),s=t.trim(o[e][1])):(a=t.trim(o[e]),s=""),n.push(['<input class="wpo_logger_addition_option" type="text" name="wpo-logger-options[',e,'][]" value="" ','placeholder="',a,'" ',""!==s?'data-validate="'+s+'"':"","/>"].join("")));return n.push('<input type="hidden" name="wpo-logger-options[active][]" value="1" />'),n.join("")}t(".wp-optimize-logging-settings").each(function(){var e=t(this);i(e),e.on("change",function(){i(e)})});var r=t("#wpo_add_logger_link");r.on("click",function(){t("#wp-optimize-logger-settings .save_settings_reminder").after(s()),n(t(".wpo_logger_type").first())}),t("#wp-optimize-nav-tab-contents-settings").on("change",".wpo_logger_type",function(){var i=t(this),o=i.val(),n=i.parent().find(".wpo_additional_logger_options");n.html(p(o)),i.val()&&e()}),t(".wpo_logging_actions_row .dashicons-edit").on("click",function(){var i=t(this),e=i.closest(".wpo_logging_row");return t(".wpo_additional_logger_options",e).removeClass("wpo_hidden"),t(".wpo_logging_options_row",e).text(""),t(".wpo_logging_status_row",e).text(""),i.hide(),!1}),t("#wp-optimize-logger-settings").on("change",".wpo_logger_addition_option",function(){e()}),t(".wpo_logger_active_checkbox").on("change",function(){var i=t(this),e=i.closest("label").find('input[type="hidden"]');e.val(i.is(":checked")?"1":"0")}),t("#wp-optimize-nav-tab-contents-settings").on("click",".wpo_delete_logger",function(){if(!confirm(wpoptimize.are_you_sure_you_want_to_remove_logging_destination))return!1;var i=t(this);return i.closest(".wpo_logging_row, .wpo_add_logger_form").remove(),o(),0==t("#wp-optimize-logging-options .wpo_logging_row").length&&t("#wp-optimize-logging-options").hide(),e(),!1})});